<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>任务面板</title>
<style>
  :root{
    --bg:#f6f7f8; --card:#fff; --text:#0f1115; --muted:#6b7280; --line:#e5e7eb;
    --accent:#2e7df6; --accent-weak:#e8f0fe; --radius:14px;
    --shadow:0 1px 2px rgba(0,0,0,.04), 0 8px 24px rgba(0,0,0,.06);
    --danger:#ef4444;
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0b0c0f; --card:#111317; --text:#e8eaed; --muted:#9aa0a6; --line:#1f232a; --accent:#3b82f6; --accent-weak:#0c1635; }
  }
  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); color:var(--text);
       font:14px/1.5 ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial;}
  .wrap{max-width:1200px; margin:32px auto; padding:0 20px; display:grid; gap:16px;
        grid-template-areas:
        "dailyHub dailyHub"
        "open done";}
  @media (max-width:900px){ .wrap{grid-template-areas:"dailyHub" "open" "done";} }
  .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden}
  .card h3{margin:0; font-size:15px; font-weight:600}
  .sub{color:var(--muted); font-size:12px}

  /* 顶部：日视图中心（昨日 + 今日） */
  .dailyHub{grid-area:dailyHub}
  .dailyHub header{display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid var(--line)}
  .hubGrid{display:grid; grid-template-columns:1fr 1fr; gap:16px; padding:16px}
  @media (max-width:900px){ .hubGrid{grid-template-columns:1fr;} }
  .panel{border:1px solid var(--line); border-radius:12px; padding:12px; background:var(--card)}
  .panel h4{margin:0 0 8px; font-size:14px}
  .list{display:flex; flex-direction:column; gap:8px}

  .row{
    display:flex; align-items:center; gap:10px;
    padding:10px 12px; border:1px solid var(--line); border-radius:12px; background:var(--card);
    position:relative;
  }
  .row input[type="checkbox"]{width:16px; height:16px; accent-color:var(--accent)}
  .row .title{flex:1 1 auto; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
  .meta{color:var(--muted); font-size:12px}
  .grow{margin-left:auto}

  /* 操作区：图标按钮，悬停淡入 */
  .actions{ display:flex; gap:6px; margin-left:8px; opacity:0; pointer-events:none; transition:opacity .16s ease; }
  .row:hover .actions, .row.show-actions .actions{ opacity:1; pointer-events:auto; }
  .icon-btn{
    display:inline-flex; align-items:center; justify-content:center;
    width:28px; height:28px; border-radius:8px; border:1px solid transparent;
    background:transparent; color:var(--muted); cursor:pointer;
  }
  .icon-btn:hover{ color:var(--accent); border-color:var(--line); background:rgba(0,0,0,0.03) }
  .icon-danger:hover{ color:var(--danger); border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.06) }
  .icon{ width:18px; height:18px; display:block }

  .todayPanel{background:var(--accent-weak); border-color:transparent}
  .todayPanel .row{background:var(--card)}

  /* 周视图 */
  .week{display:grid; gap:1px; background:var(--line); grid-template-columns:repeat(7,minmax(110px,1fr)); overflow:auto; border-top:1px solid var(--line)}
  .day{background:var(--card); padding:10px; min-height:90px}
  .head{display:flex; justify-content:space-between; color:var(--muted); font-size:12px}
  .pill{display:inline-block; font-size:11px; padding:2px 8px; border-radius:999px; background:var(--accent-weak); color:var(--accent)}

  /* 下半区：未完成 / 已完成 */
  .open{grid-area:open; padding:16px}
  .done{grid-area:done; padding:16px}
  .section{padding:14px 0; border-bottom:1px solid var(--line)}
  .grid{display:grid; gap:10px; grid-template-columns:repeat(2,minmax(0,1fr))}
  @media (max-width:700px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>

<div class="wrap">

  <!-- 上半区：日视图中心 -->
  <section class="card dailyHub">
    <header>
      <div>
        <h3>日视图中心</h3>
        <div class="sub">左：昨日回顾　|　右：今日计划</div>
      </div>
      <div class="sub">第33周 · 08-11 ~ 08-17</div>
    </header>

    <div class="hubGrid">
      <!-- 昨日回顾（可删除） -->
      <div class="panel">
        <h4>昨日回顾（08-11）</h4>
        <div class="list" id="yesterdayList">
          <div class="row" data-title="任务A">
            <input type="checkbox" checked>
            <span class="title">任务A</span>
            <span class="meta">已完成</span>
            <span class="grow"></span>
            <div class="actions">
              <button class="icon-btn icon-danger del" aria-label="删除">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </div>
          <div class="row" data-title="任务B">
            <input type="checkbox">
            <span class="title">任务B</span>
            <span class="meta">进行中</span>
            <span class="grow"></span>
            <div class="actions">
              <button class="icon-btn icon-danger del" aria-label="删除">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 今日计划（完成→周完成+从未完成移除；移回→撤销完成；可删除） -->
      <div class="panel todayPanel">
        <h4>今日计划（08-12）</h4>
        <div class="list" id="todayList"><!-- 动态加入 --></div>
      </div>
    </div>

    <!-- 周视图 -->
    <div class="week" role="list">
      <div class="day"><div class="head"><strong>周一</strong><span>08-11</span></div></div>
      <div class="day" style="background:var(--accent-weak)"><div class="head"><strong>周二</strong><span>08-12</span></div><div class="pill">今日</div></div>
      <div class="day"><div class="head"><strong>周三</strong><span>08-13</span></div></div>
      <div class="day"><div class="head"><strong>周四</strong><span>08-14</span></div></div>
      <div class="day"><div class="head"><strong>周五</strong><span>08-15</span></div></div>
      <div class="day"><div class="head"><strong>周六</strong><span>08-16</span></div></div>
      <div class="day"><div class="head"><strong>周日</strong><span>08-17</span></div></div>
    </div>
  </section>

  <!-- 下半区：未完成任务（勾选→加入今日计划且保持勾选状态；可删除） -->
  <section class="card open">
    <div class="section"><h3>未完成任务</h3></div>
    <div class="grid" id="todoList">
      <label class="row" data-title="任务A">
        <input type="checkbox" class="pick"><span class="title">任务A</span><span class="meta">未完成</span><span class="grow"></span>
        <div class="actions">
          <button class="icon-btn icon-danger del" aria-label="删除">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </label>
      <label class="row" data-title="任务B">
        <input type="checkbox" class="pick"><span class="title">任务B</span><span class="meta">未完成</span><span class="grow"></span>
        <div class="actions">
          <button class="icon-btn icon-danger del" aria-label="删除">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </label>
      <label class="row" data-title="任务C">
        <input type="checkbox" class="pick"><span class="title">任务C</span><span class="meta">未完成</span><span class="grow"></span>
        <div class="actions">
          <button class="icon-btn icon-danger del" aria-label="删除">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </label>
      <label class="row" data-title="任务D">
        <input type="checkbox" class="pick"><span class="title">任务D</span><span class="meta">未完成</span><span class="grow"></span>
        <div class="actions">
          <button class="icon-btn icon-danger del" aria-label="删除">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </label>
    </div>
  </section>

  <!-- 下半区：本周完成任务（可删除） -->
  <section class="card done">
    <div class="section"><h3>本周完成任务</h3></div>
    <div class="grid" id="doneList">
      <div class="row" data-title="任务X"><span class="title">任务X</span><span class="meta">已完成</span><span class="grow"></span>
        <div class="actions">
          <button class="icon-btn icon-danger del" aria-label="删除">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </div>
      <div class="row" data-title="任务Y"><span class="title">任务Y</span><span class="meta">已完成</span><span class="grow"></span>
        <div class="actions">
          <button class="icon-btn icon-danger del" aria-label="删除">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </div>
    </div>
  </section>

</div>

<script>
(function(){
  const qs  = (s, el=document)=>el.querySelector(s);
  const qsa = (s, el=document)=>Array.from(el.querySelectorAll(s));

  const todoList  = qs('#todoList');
  const todayList = qs('#todayList');
  const doneList  = qs('#doneList');
  const yesterday = qs('#yesterdayList');

  const norm = t => (t||'').trim();

  function findRow(container, title){
    title = norm(title);
    return qsa('[data-title]', container).find(n => norm(n.dataset.title) === title) || null;
  }
  function removeRow(container, title){
    const n = findRow(container, title);
    if(n) n.remove();
  }
  // 找到未完成里的选择框
  function findTodoCheckbox(title){
    const row = findRow(todoList, title);
    return row ? row.querySelector('input.pick') : null;
  }

  // 生成各区条目
  function svg(icon){
    if(icon==='restore'){
      return `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M9 7H5V3" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M5 7a8 8 0 1 0 2.34-5.66" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>`;
    }
    return `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path d="M3 6h18M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2M18 6l-1 14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2L6 6" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>`;
  }
  function actionIcons({restore=false, del=true}={}){
    const wrap = document.createElement('div');
    wrap.className = 'actions';
    if(restore){
      const b1 = document.createElement('button');
      b1.className = 'icon-btn restore';
      b1.setAttribute('aria-label', '移回未完成');
      b1.innerHTML = svg('restore');
      wrap.appendChild(b1);
    }
    if(del){
      const b2 = document.createElement('button');
      b2.className = 'icon-btn icon-danger del';
      b2.setAttribute('aria-label', '删除');
      b2.innerHTML = svg('trash');
      wrap.appendChild(b2);
    }
    return wrap;
  }
  function createTodayRow(title){
    const row = document.createElement('div');
    row.className = 'row';
    row.dataset.title = title;

    const doneBox = document.createElement('input');
    doneBox.type = 'checkbox';
    doneBox.className = 'done';
    row.appendChild(doneBox);

    const name = document.createElement('span');
    name.className = 'title';
    name.textContent = title;
    row.appendChild(name);

    const grow = document.createElement('span'); grow.className = 'grow';
    row.appendChild(grow);

    row.appendChild(actionIcons({restore:true, del:true}));
    return row;
  }
  function createTodoRow(title){
    const label = document.createElement('label');
    label.className = 'row';
    label.dataset.title = title;

    const pick = document.createElement('input');
    pick.type = 'checkbox';
    pick.className = 'pick';
    label.appendChild(pick);

    const t = document.createElement('span');
    t.className = 'title';
    t.textContent = title;
    label.appendChild(t);

    const meta = document.createElement('span');
    meta.className = 'meta';
    meta.textContent = '未完成';
    label.appendChild(meta);

    const grow = document.createElement('span'); grow.className = 'grow';
    label.appendChild(grow);

    label.appendChild(actionIcons({restore:false, del:true}));
    return label;
  }
  function createDoneRow(title){
    const row = document.createElement('div');
    row.className = 'row';
    row.dataset.title = title;

    const t = document.createElement('span');
    t.className = 'title';
    t.textContent = title;
    row.appendChild(t);

    const meta = document.createElement('span');
    meta.className = 'meta';
    meta.textContent = '已完成';
    row.appendChild(meta);

    const grow = document.createElement('span'); grow.className='grow';
    row.appendChild(grow);

    row.appendChild(actionIcons({restore:false, del:true}));
    return row;
  }

  // —— 防止程序性勾选/取消触发“加入今日计划”的监听
  let suppressPickChange = false;

  // —— 未完成：勾选 → 加入今日计划（去重），并保持勾选状态（仅作视觉）
  todoList.addEventListener('change', e=>{
    if(suppressPickChange) return;
    const chk = e.target;
    if(!chk.matches('input.pick')) return;

    const label = chk.closest('.row');
    if(!label) return;
    const title = label.dataset.title || label.querySelector('.title')?.textContent;

    if(chk.checked){
      if(!findRow(todayList, title)){
        todayList.appendChild(createTodayRow(title));
      }
      // 不再复位勾选：保持选中显示状态即可
      // （取消勾选只改变显示，不会自动从今日计划移除）
    }
  });

  // —— 今日计划：完成(checked) → 复制到本周完成（去重） + 从未完成移除同名
  //              取消(unchecked) → 从本周完成移除同名（若存在）
  todayList.addEventListener('change', e=>{
    const doneBox = e.target;
    if(!doneBox.matches('input.done')) return;
    const row = doneBox.closest('.row');
    const title = row?.dataset.title || row?.querySelector('.title')?.textContent;
    if(!title) return;

    if(doneBox.checked){
      if(!findRow(doneList, title)){
        doneList.appendChild(createDoneRow(title));
      }
      // 完成后：未完成区不应再有同名（移除整行）
      removeRow(todoList, title);
    }else{
      // 取消完成：撤销“本周完成”
      removeRow(doneList, title);
      // 未完成区展示状态不变（是否勾选由用户决定）
    }
  });

  // —— 今日计划：图标操作（移回未完成 / 删除）
  todayList.addEventListener('click', e=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const row = btn.closest('.row');
    const title = row?.dataset.title || row?.querySelector('.title')?.textContent;
    if(!title) return;

    if(btn.classList.contains('restore')){
      // 撤销完成 & 同步未完成显示为“未选中”
      removeRow(doneList, title);

      const existing = findRow(todoList, title);
      if(existing){
        const cb = existing.querySelector('input.pick');
        if(cb){
          suppressPickChange = true; // 防止触发“加入今日计划”
          cb.checked = false;        // 只更新显示状态
          suppressPickChange = false;
        }
      }else{
        // 未找到则新增一个未勾选的“未完成”条目
        todoList.prepend(createTodoRow(title));
      }
      row.remove();
      return;
    }

    if(btn.classList.contains('del')){
      // 删除今日项 & 对应“本周完成”一并清理
      removeRow(doneList, title);
      row.remove();
      return;
    }
  });

  // —— 未完成 / 本周完成 / 昨日回顾：删除（图标）
  [todoList, doneList, yesterday].forEach(list=>{
    list.addEventListener('click', e=>{
      const btn = e.target.closest('button');
      if(!btn || !btn.classList.contains('del')) return;
      btn.closest('.row')?.remove();
    });
  });

  // —— 触屏支持：点行显示图标操作，再点空白关闭
  const allContainers = [todayList, todoList, doneList, yesterday];
  allContainers.forEach(c=>{
    c.addEventListener('touchstart', e=>{
      const row = e.target.closest('.row');
      if(!row) return;
      qsa('.row.show-actions', c).forEach(r=>{ if(r!==row) r.classList.remove('show-actions'); });
      row.classList.add('show-actions');
    }, {passive:true});
  });
  document.addEventListener('touchstart', e=>{
    if(!e.target.closest('.row')){
      qsa('.row.show-actions').forEach(r=>r.classList.remove('show-actions'));
    }
  }, {passive:true});

})();
</script>

</body>
</html>
